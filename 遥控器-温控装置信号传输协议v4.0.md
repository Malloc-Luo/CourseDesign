## 遥控器-温控装置信号传输协议v4.0



### 一、下位机与上位机串口通信协议：

上位机遥控器端蓝牙串口做为master，下位机蓝牙串口做slave。串口参数：

*   波特率：9600
*   停止位：1
*   校验方式：无校验
*   帧长度：8 bit

每一帧数据有4 byte，分为 起始帧，指令帧，数据帧。

| Byte |       Note        |
| :--: | :---------------: |
|  1   | 0xA5 Frame Header |
|  2   |      指令帧       |
|  3   |    数据帧高8位    |
|  4   |    数据帧低8位    |



#### 数据位：

数据位为`%3.1f`类型的浮点数乘以10之后强制转换成`uint16_t`的数据，大小为0~999

#### 控制位：

控制位指示数据位的类型，占4bit

| Value | Note               |
| ----- | ------------------ |
| 0x01  | 数据位为温度设定值 |
| 0x02  | 数据位为温度当前值 |
| 0x04  | 重置温度最低值     |

### 二、程序实现示例：

合成发送数据帧：

```c
float tempf;
uint16_t tempi= (int16_t)(tempf * 10);
uint8_t construction;

void bt_send_data(uint8_t *cmd, uint16_t *dat)
{
    uint8_t * ptr = (uint8_t *)dat;
    /* 数据帧头0xa5 */
    uart_send(FRAME_HEADER);
    /* 指令帧 */
    uart_send(*cmd);
    /* 数据帧 */
    uart_send(*(ptr + 0));
    uart_send(*(ptr + 1));
}
```

还原接收数据帧：

```c
uint8_t instruct = Buffer[0];
uint16_t temp = *(uint16_t *)(Buffer + 1);
```